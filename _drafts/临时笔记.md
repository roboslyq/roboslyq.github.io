

# 20190313



 # 1. Arrays.copyof相关

底层使用了System.arraycopy,而System.copy使用了native方法：

```java
public static char[] copyOf(char[] original, int newLength) {
        char[] copy = new char[newLength];
        System.arraycopy(original, 0, copy, 0,
                         Math.min(original.length, newLength));
        return copy;
```

```java
 public static native void arraycopy(Object src,  int  srcPos,
                                        Object dest, int destPos,
                                        int length);
```

# 2.StringCoding

将其它类型转换`String`类型 。即String类型编码的工具类



# String总结

1. `String`底层没有String，本质是一个char数组。

   ```java
   private final char value[];
   ```

2. 常见的String操作其实是针对字符数组的操作。

   比如说，判断字符串是否以某个字符串开头。

   ```java
   public boolean startsWith(String prefix) {
           return startsWith(prefix, 0);
     }
   public boolean startsWith(String prefix, int toffset) {
           char ta[] = value;
           int to = toffset;
           char pa[] = prefix.value;
           int po = 0;
           int pc = prefix.value.length;
           // Note: toffset might be near -1>>>1.
           if ((toffset < 0) || (toffset > value.length - pc)) {
               return false;
           }
           while (--pc >= 0) {
               if (ta[to++] != pa[po++]) {
                   return false;
               }
           }
           return true;
       }
   ```

3. HashCode

   String的Hash值算法如下：

   ```java
   /** Cache the hash code for the string */
   private int hash; // Default to 0
   public int hashCode() {
       //
       int h = hash;
       if (h == 0 && value.length > 0) {
           char val[] = value;
           for (int i = 0; i < value.length; i++) {
               h = 31 * h + val[i];
           }
           hash = h;
       }
       return h;
   }
   ```

   > 1. hash值有缓存，缓存在hash变量中。默认为0，所以第一次获取hash需要计算。后续获取hash值不需要计算。
   > 2. 为什么hashCode因子要用31？首先31是一个素数，然后31 * i == (i << 5) - i，可以使用位移和减法快速完成。

4. 

5. 你

6. 

7. N多个构造函数，适应不同的数据来源以便转换成String类型。参数主要是各种编码类型的byte数组和偏移量及长度。例如：

```java
//-----------   
public String(byte ascii[], int hibyte) {
        this(ascii, hibyte, 0, ascii.length);
    }
//------------
  public String(byte ascii[], int hibyte, int offset, int count) {
  }

```

